if (MSVC) # MSVC needs to download and build dependencies of CEGUI
    set(CEGUI_DEPS_URL "https://sourceforge.net/projects/crayzedsgui/files/CEGUI%20Mk-2%20Dependencies/0.8.x/cegui-deps-0.8.x-src.zip/download")
    set(CEGUI_DEPS_ARCHIVE ${CMAKE_CURRENT_SOURCE_DIR}/cegui-deps-0.8.x-src.zip)
    set(CEGUI_DEPS_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cegui-cegui-dependencies-0ecdf3a9e49b)
    set(CEGUI_DEPS_INSTALL_PATH ${CEGUI_PATH}/dependencies)
    set(CEGUI_DEPS_INSTALL_PATH ${CEGUI_DEPS_INSTALL_PATH} PARENT_SCOPE)

    if (NOT EXISTS "${CEGUI_DEPS_ARCHIVE}")
        message(STATUS "Downloading CEGUI 0.8.x dependencies")
        file(
            DOWNLOAD "${CEGUI_DEPS_URL}" "${CEGUI_DEPS_ARCHIVE}"
            SHOW_PROGRESS
        )
    endif()
    message(STATUS "CEGUI 0.8.x dependencies downloaded")

    if (NOT EXISTS "${CEGUI_DEPS_PATH}")
        message(STATUS "Extracting CEGUI 0.8.x dependencies")
        execute_process(
            COMMAND ${CMAKE_COMMAND} -E tar xzf ${CEGUI_DEPS_ARCHIVE}
            WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
        )
        message(STATUS "Extracting done")
    endif()

    # Disable unused CEGUI dependencies
    set(CEGUI_BUILD_CORONA OFF CACHE BOOL "")
    set(CEGUI_BUILD_DEVIL OFF CACHE BOOL "")
    set(CEGUI_BUILD_FREEIMAGE OFF CACHE BOOL "")
    set(CEGUI_BUILD_GLFW OFF CACHE BOOL "")
    set(CEGUI_BUILD_LUA OFF CACHE BOOL "")
    set(CEGUI_BUILD_MINIZIP OFF CACHE BOOL "")
    set(CEGUI_BUILD_SILLY OFF CACHE BOOL "")
    set(CEGUI_BUILD_TINYXML OFF CACHE BOOL "")
    set(CEGUI_BUILD_XERCES OFF CACHE BOOL "")
    set(CEGUI_BUILD_ZLIB OFF CACHE BOOL "")
    set(CEGUI_BUILD_TOLUAPP OFF CACHE BOOL "")

    # Enable required CEGUI dependencies
    set(CEGUI_BUILD_EXPAT ON CACHE BOOL "")
    set(CEGUI_BUILD_FREETYPE2 ON CACHE BOOL "")
    set(CEGUI_BUILD_GLEW ON CACHE BOOL "")
    set(CEGUI_BUILD_GLM ON CACHE BOOL "")
    set(CEGUI_BUILD_PCRE ON CACHE BOOL "")
    set(CEGUI_MSVC_STATIC_RUNTIME ON CACHE BOOL "")

    add_subdirectory(${CEGUI_DEPS_PATH})
endif()


# Disable unused CEGUI options
set(CEGUI_INSTALL_PKGCONFIG OFF CACHE BOOL "")
set(CEGUI_BUILD_APPLICATION_TEMPLATES OFF CACHE BOOL "")
set(CEGUI_BUILD_PYTHON_MODULES OFF CACHE BOOL "")
set(CEGUI_BUILD_LUA_MODULE OFF CACHE BOOL "")
set(CEGUI_BUILD_XMLPARSER_XERCES OFF CACHE BOOL "")
set(CEGUI_BUILD_XMLPARSER_TINYXML OFF CACHE BOOL "")
set(CEGUI_BUILD_XMLPARSER_TINYXML2 OFF CACHE BOOL "")
set(CEGUI_BUILD_XMLPARSER_LIBXML2 OFF CACHE BOOL "")
set(CEGUI_BUILD_XMLPARSER_RAPIDXML OFF CACHE BOOL "")
set(CEGUI_BUILD_RENDERER_OPENGL OFF CACHE BOOL "")
set(CEGUI_SAMPLES_ENABLED OFF CACHE BOOL "")

# Enable required CEGUI options
set(CEGUI_STRING_CLASS "2" CACHE STRING "")
set(CEGUI_HAS_FREETYPE ON CACHE BOOL "")
set(CEGUI_HAS_PCRE_REGEX ON CACHE BOOL "")
set(CEGUI_BUILD_XMLPARSER_EXPAT ON CACHE BOOL "")
set(CEGUI_BUILD_IMAGECODEC_STB ON CACHE BOOL "") # needs at least 1 image codec module
set(CEGUI_BUILD_RENDERER_OPENGL3 ON CACHE BOOL "")
set(CEGUI_BUILD_STATIC_CONFIGURATION ON CACHE BOOL "")
set(CEGUI_BUILD_STATIC_FACTORY_MODULE ON CACHE BOOL "")
#set(CEGUI_STATIC_XMLPARSER_MODULE "CEGUIExpatParser" CACHE STRING "")

add_subdirectory(cegui)
